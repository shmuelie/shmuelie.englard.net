var __decorate=this&&this.__decorate||function(t,e,o,r){var s,l=arguments.length,i=l<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,o,r);else for(var n=t.length-1;n>=0;n--)(s=t[n])&&(i=(l<3?s(i):l>3?s(e,o,i):s(e,o))||i);return l>3&&i&&Object.defineProperty(e,o,i),i};import{attr,observable,FASTElement,customElement,nullableNumberConverter}from"https://unpkg.com/@microsoft/fast-element@1.13.0";import{register}from"https://unpkg.com/hashed-es6@1.0.3";import{Blog}from"../drop-in-blog/Blog.js";import{template}from"./template.js";import{styles}from"./styles.js";let FluentBlog=class extends FASTElement{constructor(){super(...arguments),this.updateHash=null,this.boundHashUpdated=this.hashUpdated.bind(this),this.blogApi=null,this.loading=!1,this.posts=[],this.post=null,this.currentPage=null,this.currentPost=null,this.blogId=null,this.oauthKey=null}get currentPageId(){return this.id+"Page"}get currentPostId(){return this.id+"Post"}currentPageChanged(){var t,e;this.updateHash&&(this.updateHash({[this.currentPageId]:null!==(e=null===(t=this.currentPage)||void 0===t?void 0:t.toString())&&void 0!==e?e:""}),this._load())}currentPostChanged(){var t,e;this.updateHash&&(this.updateHash({[this.currentPostId]:null!==(e=null===(t=this.currentPost)||void 0===t?void 0:t.toString())&&void 0!==e?e:""}),this._load())}configureBlogApi(){!this.blogApi&&this.blogId&&this.oauthKey&&(this.blogApi=new Blog(this.blogId,this.oauthKey)),this.updateHash&&this._load()}blogIdChanged(){this.configureBlogApi()}oauthKeyChanged(){this.configureBlogApi()}connectedCallback(){var t,e,o,r;super.connectedCallback(),this.updateHash=register({[this.currentPageId]:null!==(e=null===(t=this.currentPage)||void 0===t?void 0:t.toString())&&void 0!==e?e:"",[this.currentPostId]:null!==(r=null===(o=this.currentPost)||void 0===o?void 0:o.toString())&&void 0!==r?r:""},this.boundHashUpdated)}hashUpdated(t){let e=t[this.currentPageId];""===e&&(e=null);let o=t[this.currentPostId];""===o&&(o=null),this.currentPage=Number(e),this.currentPost=Number(o),this._load()}async _load(){if(!this.loading){this.loading=!0,this.posts.splice(0,this.posts.length);try{await this._loadPost()||await this._loadPosts()}catch{}this.$emit("change"),this.loading=!1}}async _loadPost(){var t;if(this.currentPost)try{const e=await(null===(t=this.blogApi)||void 0===t?void 0:t.getPost(this.currentPost));if(e)return this.post=e,!0}catch{}return!1}async _loadPosts(){var t,e;let o;this.currentPost=null,this.post=null,o=this.currentPage?this.currentPage:0;try{const r=await(null===(t=this.blogApi)||void 0===t?void 0:t.getPosts({page:o}));if(r)for(const t of null!==(e=r.posts)&&void 0!==e?e:[])t&&this.posts.push(t)}catch{}}};__decorate([observable],FluentBlog.prototype,"loading",void 0),__decorate([observable],FluentBlog.prototype,"posts",void 0),__decorate([observable],FluentBlog.prototype,"post",void 0),__decorate([attr({attribute:"current-page",converter:nullableNumberConverter})],FluentBlog.prototype,"currentPage",void 0),__decorate([attr({attribute:"current-post",converter:nullableNumberConverter})],FluentBlog.prototype,"currentPost",void 0),__decorate([attr({attribute:"blog-id"})],FluentBlog.prototype,"blogId",void 0),__decorate([attr({attribute:"oauth-key"})],FluentBlog.prototype,"oauthKey",void 0),FluentBlog=__decorate([customElement({name:"fluent-blog",template:template,styles:styles})],FluentBlog);export{FluentBlog};
//# sourceMappingURL=FluentBlog.js.map
