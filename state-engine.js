import{register,unregister}from"https://unpkg.com/hashed-es6@1.0.2";const dataStateAttributeName="data-state";export class StateEngine{constructor(){this.updateHash=null,this.config={},this.boundHashUpdated=this.hashUpdated.bind(this),this.boundElementUpdated=this.elementUpdated.bind(this),this.tagConfigs={}}hashUpdated(t){setTimeout((()=>{for(const e of Object.keys(t)){const i=this.config[e];i&&i.element.setAttribute(i.attribute,t[e])}}),0)}elementUpdated(t){const e=t.target;e&&setTimeout((()=>{const t=this.getConfig(e);if(t)if(this.updateHash){const i=t.attribute;this.updateHash({[t.id]:e.getAttribute(i)})}else t.event&&e.removeEventListener(t.event,this.boundElementUpdated)}),0)}initialize(t){this.reset();const e={};for(const i of t.querySelectorAll("*[data-state]")){const t=this.getConfig(i);t&&(this.config[t.id]=t,e[t.id]=i.getAttribute(t.attribute)||"",i.addEventListener(t.event,this.boundElementUpdated))}this.updateHash=register(e,this.boundHashUpdated)}reset(){this.updateHash&&unregister(this.updateHash);for(const t of Object.keys(this.config)){const e=this.config[t];e&&e.element.removeEventListener(e.event,this.boundElementUpdated)}}getConfig(t){var e,i,s,n;if(t.hasAttribute("data-state")){const a=JSON.parse(t.getAttribute("data-state")||"{}"),d=t.id||a.id,o=this.tagConfigs[t.tagName],r=null!==(i=null!==(e=a.event)&&void 0!==e?e:null==o?void 0:o.event)&&void 0!==i?i:null,u=null!==(n=null!==(s=a.attribute)&&void 0!==s?s:null==o?void 0:o.attribute)&&void 0!==n?n:null;if(d&&r&&u)return{attribute:u,element:t,event:r,id:d}}return null}}
//# sourceMappingURL=state-engine.js.map
